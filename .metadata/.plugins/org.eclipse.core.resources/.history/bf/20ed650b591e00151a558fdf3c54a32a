package Controller;

import java.io.IOException;
import java.sql.SQLException;
import java.util.List;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import DAO.TimetableDAO;
import Model.Timetable;

public class CRUD extends HttpServlet{

    TimetableDAO tbDAO = new TimetableDAO();
    
    @Override
	public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException{
       String action = request.getParameter("action");
       if(action.equals("delete"))
       {
    	   Integer id = Integer.parseInt(request.getParameter("id"));
    	   try 
    	   {
		   obj.delete(obj.getSaller(id));
		   } catch (SQLException e){ e.printStackTrace(); }
    	   request.getRequestDispatcher("index.jsp").forward(request, response);
       }
       else if(action.equals("edit"))
       {
    	   try
    	   {
		    request.setAttribute("p", obj.getSaller(Integer.parseInt(request.getParameter("id"))));
		   } catch (NumberFormatException | SQLException e) {e.printStackTrace();}
    	   request.getRequestDispatcher("edit.jsp").forward(request, response);
       }
       
	}
    
	@Override
	public void doPost(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException{
	 String action = request.getParameter("action");
	 if(action.equals("add")){
	 Student stud = new Student();
	 stud.setId(Integer.parseInt(request.getParameter("id")));
	 stud.setFirstName(request.getParameter("fs"));
	 stud.setLastName(request.getParameter("ls"));
	 stud.setEmail(request.getParameter("email"));
	 try {
	  obj.add(stud);
	  } catch (SQLException e) { e.printStackTrace(); }
	 request.getRequestDispatcher("index.jsp").forward(request, response);
	 }else if(action.equals("processEdit")){
	  try {
	  String word = request.getParameter("id");
	  Integer id = Integer.parseInt(word);
	  Student stud = obj.getSaller(id);
	  stud.setId(Integer.parseInt(request.getParameter("id")));
	  stud.setFirstName(request.getParameter("fs"));
	  stud.setLastName(request.getParameter("ls"));
	  stud.setEmail(request.getParameter("email"));
	  obj.update(stud);
	  } catch (NumberFormatException | SQLException e) {e.printStackTrace();}
	  request.getRequestDispatcher("index.jsp").forward(request, response);
	 }
	}
	

}
